{"version":3,"sources":["uni-app:///main.js","webpack:///D:/weixinapp/ResumeBoost/resume-optimization-frontend/pages/me/me.vue?4714","webpack:///D:/weixinapp/ResumeBoost/resume-optimization-frontend/pages/me/me.vue?3c0d","webpack:///D:/weixinapp/ResumeBoost/resume-optimization-frontend/pages/me/me.vue?4cf0","webpack:///D:/weixinapp/ResumeBoost/resume-optimization-frontend/pages/me/me.vue?9d12","uni-app:///pages/me/me.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","userInfo","hasUserInfo","defaultAvatar","token","onLoad","withShareTicket","menus","methods","checkLogin","handleLogin","uni","provider","success","fail","loginRes","code","console","userInfoRes","wxUserInfo","request","response","title","icon","updateNickName","content","editable","res","newNickName","userId","nickName","onShareAppMessage","path","mpId","onShareTimeline","query","imageUrl"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,WAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+G;AAC/G;AACsD;AACL;AACa;;;AAG9D;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,wEAAM;AACR,EAAE,6EAAM;AACR,EAAE,sFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAA8mB,CAAgB,4mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;ACuCloB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA,eACA;EACAC;IACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;IACA;EACA;EACAC;IACA;IACAV;MACAW;MACAC;IACA;EACA;EACAC;IACA;IACAC;MACA;MACA;QACA;QACA;MACA;QACA;MACA;IACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAGA;kBACAC;oBACAC;oBACAC;oBACAC;kBACA;gBACA;cAAA;gBANAC;gBAOAC;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACAC;;gBAEA;gBAAA;gBAAA,OACA;kBACAN;oBACAC;oBACAC;oBACAC;kBACA;gBACA;cAAA;gBANAI;gBAOAC;gBACAF;gBACAA;gBACAA;gBAAA;gBAAA,OAEAG;kBACAJ;kBACAf;gBACA;cAAA;gBAHAoB;gBAIA;kBACAV;kBACAM;gBACA;kBACAA;gBACA;gBAAA,MAEAI;kBAAA;kBAAA;gBAAA;gBACA;gBACA;gBACA;gBACAV;gBACAA;kBACAW;kBACAC;gBACA;gBAAA;gBAAA;cAAA;gBAAA,MAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAN;gBACAN;kBACAW;kBACAC;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAGA;kBACAb;oBACAW;oBACAG;oBACAC;oBACAb;oBACAC;kBACA;gBACA;cAAA;gBARAa;gBAAA,KAUAA;kBAAA;kBAAA;gBAAA;gBACAC,2BAEA;gBAAA;gBAAA,OACAR;kBACAS;kBAAA;kBACAC;gBACA;cAAA;gBAHAT;gBAAA,MAKAA;kBAAA;kBAAA;gBAAA;gBACA;gBACA;gBACAV;gBACAA;kBACAW;kBACAC;gBACA;gBAAA;gBAAA;cAAA;gBAAA,MAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAIAN;gBACAN;kBACAW;kBACAC;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAQ;MACA;QACAd;MACA;MACA;QACAK;QACAU;QACAC;MACA;IACA;IACAC;MACA;QACAZ;QACAa;QACAC;MACA;IACA;EACA;AACA;AAAA,2B","file":"pages/me/me.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/me/me.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./me.vue?vue&type=template&id=259fb574&\"\nvar renderjs\nimport script from \"./me.vue?vue&type=script&lang=js&\"\nexport * from \"./me.vue?vue&type=script&lang=js&\"\nimport style0 from \"./me.css?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/me/me.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./me.vue?vue&type=template&id=259fb574&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./me.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./me.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"page_container\">\n    <!-- 顶部背景 -->\n    <view class=\"top_bg\"></view>\n\n    <!-- 主内容区域 -->\n    <view class=\"main_content\">\n      <!-- 用户信息展示 -->\n      <view v-if=\"hasUserInfo\" class=\"userinfo_container\">\n        <image class=\"avatar\" :src=\"userInfo.avatarUrl\" mode=\"widthFix\" />\n        <text class=\"username\">{{ userInfo.nickName }}</text>\n      </view>\n\n      <!-- 未登录时显示默认头像 -->\n      <view v-else class=\"userinfo_container\">\n        <image class=\"avatar\" :src=\"defaultAvatar\" mode=\"widthFix\" />\n        <text class=\"username\">未登录</text>\n      </view>\n\n      <!-- 设置项展示 -->\n      <view class=\"settings_container\">\n        <view class=\"setting_item\" @click=\"updateNickName\">\n          <view class=\"left\">\n            <image class=\"setting_icon\" src=\"@/static/icon/share.svg\" />\n            <view class=\"setting_text\">修改昵称</view>\n          </view>\n          <image class=\"arrow_icon\" src=\"@/static/icon/arrow.svg\" />\n        </view>\n      </view>\n\n      <!-- 登录按钮 -->\n      <view v-if=\"!hasUserInfo\" class=\"login-btn-container\">\n        <button class=\"login-btn\" @click=\"handleLogin\">微信授权登录</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport request from '@/utils/request.js'; // 导入 request.js\nexport default {\n  data() {\n    return {\n      userInfo: null, // 用户信息\n      hasUserInfo: false, // 是否已获取用户信息\n      defaultAvatar: require('@/static/icon/avatar.png'), // 默认头像路径\r\n\t\t\ttoken: null\n    };\n  },\n  onLoad() {\n    this.checkLogin();\n\twx.showShareMenu({\n\twithShareTicket: true,\n\tmenus: [\"shareAppMessage\", \"shareTimeline\"]\n\t});\n  },\n  methods: {\n    // 检查登录状态\n    checkLogin() {\n      const userInfo = uni.getStorageSync('userInfo');\n      if (userInfo) {\n        this.userInfo = userInfo;\n        this.hasUserInfo = true;\n      } else {\n        this.hasUserInfo = false;\n      }\n    },\n    // 处理登录逻辑\n    async handleLogin() {\n      try {\n        // 1. 获取临时凭证 code\n        const loginRes = await new Promise((resolve, reject) => {\n          uni.login({\n            provider: 'weixin',\n            success: resolve,\n            fail: reject,\n          });\n        });\n        const code = loginRes.code;\n        if (!code) throw new Error('登录失败：无法获取 code');\n        console.log('临时凭证 code:', code);\n\n        // 2. 获取用户信息\n        const userInfoRes = await new Promise((resolve, reject) => {\n          uni.getUserInfo({\n            provider: 'weixin',\n            success: resolve,\n            fail: reject,\n          });\n        });\n        const wxUserInfo = userInfoRes.userInfo;\n        console.log('用户头像:', wxUserInfo.avatarUrl);\n        console.log('用户昵称:', wxUserInfo.nickName);\n        console.log('用户详细信息:', wxUserInfo);\n\n        const response = await request.post('/user/login', {\r\n          code,\r\n          userInfo: wxUserInfo,\r\n        });\r\n        if (response.data && response.data.token) {\r\n          uni.setStorageSync('token', response.data.token); \r\n          console.log('Token已存储');\r\n        } else {\r\n          console.error('Token未找到于响应中');\r\n        }\r\n        \r\n        if (response.code === '200') {\n          // 登录成功，保存用户信息\n          this.userInfo = wxUserInfo;\n          this.hasUserInfo = true;\n          uni.setStorageSync('userInfo', wxUserInfo);\n          uni.showToast({\n            title: '登录成功',\n            icon: 'success',\n          });\n        } else {\n          throw new Error('登录失败：后端接口返回错误');\n        }\n      } catch (error) {\n        console.error('登录出错:', error);\n        uni.showToast({\n          title: '登录失败，请重试',\n          icon: 'none',\n        });\n      }\n    },\n\t\tasync updateNickName() {\n\t\t\ttry {\n\t\t\t// 弹出输入框，让用户输入新的昵称\n\t\t\tconst res = await new Promise((resolve, reject) => {\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '修改昵称',\n\t\t\t\tcontent: '请输入新的昵称',\n\t\t\t\teditable: true,\n\t\t\t\tsuccess: resolve,\n\t\t\t\tfail: reject,\n\t\t\t});\n\t\t\t});\n\n\t\t\tif (res.confirm) {\n\t\t\tconst newNickName = res.content;\n\n\t\t\t// 发送请求到后端更新昵称\n\t\t\tconst response = await request.post('/user/updateNickName', {\n\t\t\t\tuserId: this.userInfo.userId, // 假设用户信息中有 userId\n\t\t\t\tnickName: newNickName,\n\t\t\t});\n\n\t\t\tif (response.code === '200') {\n\t\t\t\t// 更新成功，更新本地用户信息\n\t\t\t\tthis.userInfo.nickName = newNickName;\n\t\t\t\tuni.setStorageSync('userInfo', this.userInfo);\n\t\t\t\tuni.showToast({\n\t\t\t\ttitle: '昵称修改成功',\n\t\t\t\ticon: 'success',\n\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('昵称修改失败：后端接口返回错误');\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('修改昵称出错:', error);\n\t\t\tuni.showToast({\n\t\t\ttitle: '修改昵称失败，请重试',\n\t\t\ticon: 'none',\n\t\t\t});\n\t\t}\n\t},\n\tonShareAppMessage(res) {\n\tif (res.from === 'button') {\n\tconsole.log(res.target);\n\t}\n\treturn {\n\ttitle: '分享给微信好友',\n\tpath: '/pages/index/index',\n\tmpId: 'wx6bf107b87c455b99'\n\t};\n\t},\n\tonShareTimeline(res) {\n\treturn {\n\ttitle: '分享到朋友圈',\n\tquery: 'pages/index/index',\n\timageUrl: '/static/index.png'\n\t};\n\t}\n  },\n};\n</script>\r\n\n<style src=\"./me.css\"></style>\n"],"sourceRoot":""}